#!/bin/bash
set -eux

ls -l "${SRCDIR}"

BEACON_DIR="${SRCDIR}/beacon"

curl https://sh.rustup.rs -sSf | sh -s -- -y
source "$HOME/.cargo/env"

rustup target add x86_64-unknown-linux-musl

cargo build  --release --manifest-path "${BEACON_DIR}/Cargo.toml" --target=x86_64-unknown-linux-musl

install -Dm755 \
  "${BEACON_DIR}/target/x86_64-unknown-linux-musl/release/beacon" \
  "${DESTDIR}/usr/local/bin/beacon"
